<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Management System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #2c3e50;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #4a69bd 0%, #1e3799 100%);
            color: white;
            padding: 0 40px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .tabs {
            display: flex;
            gap: 5px;
        }

        .tab {
            padding: 8px 20px;
            background: rgba(255,255,255,0.1);
            border: none;
            border-radius: 6px;
            color: rgba(255,255,255,0.8);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .tab:hover {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .tab.active {
            background: white;
            color: #4a69bd;
        }

        .main-content {
            margin-top: 80px;
            min-height: calc(100vh - 80px);
            background: white;
        }

        .content-header {
            padding: 30px 40px 20px;
            border-bottom: 1px solid #e8ecef;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2c3e50;
        }

        .add-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .add-btn:hover {
            background: #219a52;
        }

        .tab-content {
            display: none;
            padding: 0;
        }

        .tab-content.active {
            display: block;
        }

        /* Task Table */
        .table-container {
            overflow-x: auto;
            background: white;
        }

        .task-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }

        .task-table th {
            background: #f8f9fb;
            padding: 15px 20px;
            text-align: left;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #6c7b84;
            border-bottom: 1px solid #e8ecef;
        }

        .task-table td {
            padding: 15px 20px;
            border-bottom: 1px solid #f1f3f5;
        }

        .task-table tr:hover {
            background: #f8f9fb;
            cursor: pointer;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .status-in-progress {
            background: #3498db;
            color: white;
        }

        .status-not-started {
            background: #95a5a6;
            color: white;
        }

        .status-complete {
            background: #27ae60;
            color: white;
        }

        .status-on-hold {
            background: #f39c12;
            color: white;
        }

        .status-cancelled {
            background: #e74c3c;
            color: white;
        }

        .priority-high {
            color: #e74c3c;
            font-weight: 600;
        }

        .priority-medium {
            color: #f39c12;
            font-weight: 600;
        }

        .priority-low {
            color: #27ae60;
            font-weight: 600;
        }

        .progress-text {
            font-weight: 500;
            color: #2c3e50;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .delete-btn:hover {
            background: #c0392b;
        }

        /* Gantt Chart */
        .gantt-controls {
            padding: 20px 40px;
            background: #f8f9fb;
            border-bottom: 1px solid #e8ecef;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .gantt-btn {
            padding: 8px 16px;
            background: #4a69bd;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .gantt-btn:hover {
            background: #3c5aa6;
        }

        .gantt-container {
            background: white;
            overflow-x: auto;
        }

        .gantt-grid {
            position: relative;
            min-width: 1200px;
        }
        
        .gantt-header {
            display: flex;
            background: #2c3e50;
            color: white;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .gantt-task-column {
            width: 200px;
            padding: 15px 20px;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-right: 1px solid #34495e;
            flex-shrink: 0;
        }

        .gantt-timeline {
            display: flex;
            width: 100%;
        }

        .gantt-month {
            padding: 15px 10px;
            text-align: center;
            border-right: 1px solid #34495e;
            font-weight: 600;
            font-size: 12px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .gantt-row {
            display: flex;
            border-bottom: 1px solid #f1f3f5;
            height: 50px;
            align-items: center;
        }

        .gantt-row:hover {
            background: #f8f9fb;
        }
        
        .gantt-row.main-task-row {
            background: #e0e0e0 !important;
            color: #2c3e50 !important;
            font-weight: 600;
            border-left: 3px solid #3498db;
        }

        .gantt-row.main-task-row .gantt-task-name,
        .gantt-row.main-task-row .expand-btn {
            color: #2c3e50 !important;
        }

        .gantt-row.sub-task-row {
            background: white;
        }

        .gantt-task-name {
            width: 200px;
            padding: 0 20px;
            font-size: 14px;
            color: #2c3e50;
            border-right: 1px solid #e8ecef;
            flex-shrink: 0;
            display: flex;
            align-items: center;
        }

        .gantt-bars {
            flex: 1;
            position: relative;
            height: 100%;
            display: flex;
            align-items: center;
        }

        .gantt-v-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: #e8ecef;
            z-index: 1;
        }

        .gantt-bar {
            position: absolute;
            height: 20px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            z-index: 3;
        }

        .gantt-bar.main-task {
            background: #3498db;
            height: 24px;
        }

        .gantt-bar.sub-task {
            background: #27ae60;
            height: 16px;
        }

        .gantt-progress-label {
            position: absolute;
            color: #2c3e50;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            line-height: 20px;
            z-index: 5;
        }
        
        .main-task-row .gantt-progress-label {
             color: #2c3e50;
        }

        .current-day-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e74c3c;
            z-index: 10;
        }

        .expand-btn {
            background: none;
            border: none;
            margin-right: 8px;
            cursor: pointer;
            font-size: 12px;
            color: #6c7b84;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .expand-btn:hover {
            color: #2c3e50;
        }

        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1px;
            background: #e8ecef;
            min-height: calc(100vh - 160px);
        }

        .kanban-column {
            background: white;
            padding: 20px;
            overflow-y: auto;
        }

        .kanban-header {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .kanban-count {
            background: #6c7b84;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 600;
        }

        .kanban-card {
            background: #f8f9fb;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 3px solid #3498db;
            font-size: 13px;
        }

        .kanban-card h4 {
            margin-bottom: 8px;
            color: #2c3e50;
            font-size: 14px;
            font-weight: 600;
        }

        .kanban-card .sub-task {
            color: #6c7b84;
            margin-bottom: 8px;
        }

        .kanban-card .assigned-to {
            color: #6c7b84;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .kanban-card .progress {
            color: #2c3e50;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .kanban-card .dates {
            color: #6c7b84;
            font-size: 11px;
        }

        /* Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1px;
            background: #e8ecef;
            min-height: calc(100vh - 160px);
        }

        .dashboard-card {
            background: white;
            padding: 40px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .dashboard-card h3 {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 700;
        }

        .dashboard-card p {
            color: #6c7b84;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .dashboard-card.completed h3 {
            color: #27ae60;
        }

        .dashboard-card.in-progress h3 {
            color: #3498db;
        }

        .dashboard-card.overdue h3 {
            color: #e74c3c;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .confirm-modal-content {
            background: white;
            padding: 30px;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
            position: relative;
        }

        .confirm-modal h3 {
            margin-bottom: 20px;
            color: #2c3e50;
        }

        .confirm-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal h2 {
            margin-bottom: 20px;
            color: #2c3e50;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #2c3e50;
            font-size: 13px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e8ecef;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4a69bd;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: background 0.2s ease;
        }

        .btn-primary {
            background: #4a69bd;
            color: white;
        }

        .btn-primary:hover {
            background: #3c5aa6;
        }

        .btn-secondary {
            background: #6c7b84;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6c75;
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            color: #6c7b84;
            line-height: 1;
        }

        .close:hover {
            color: #2c3e50;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .header {
                padding: 0 20px;
                flex-direction: column;
                height: auto;
                padding: 15px 20px;
            }

            .main-content {
                margin-top: 120px;
            }

            .tabs {
                margin-top: 10px;
            }

            .content-header {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .kanban-board, .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .task-table {
                font-size: 12px;
            }

            .task-table th, .task-table td {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>PROJECT MANAGEMENT SYSTEM</h1>
        <div class="tabs">
            <button class="tab active" onclick="showTab('task-management', this)">Task Management</button>
            <button class="tab" onclick="showTab('gantt-chart', this)">Gantt Chart</button>
            <button class="tab" onclick="showTab('kanban-board', this)">Kanban Board</button>
            <button class="tab" onclick="showTab('dashboard', this)">Dashboard</button>
        </div>
    </div>

    <div class="main-content">
        <div id="task-management" class="tab-content active">
            <div class="content-header">
                <h2 class="content-title">Project Tasks Overview</h2>
                <button class="add-btn" onclick="openAddTaskModal()">+ Add New Task</button>
            </div>
            <div class="table-container">
                <table class="task-table">
                    <thead>
                        <tr>
                            <th>Main Task</th>
                            <th>Sub Task</th>
                            <th>Description</th>
                            <th>Assigned To</th>
                            <th>Start Date</th>
                            <th>End Date</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Progress</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="task-table-body">
                        </tbody>
                </table>
            </div>
        </div>

        <div id="gantt-chart" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Project Timeline - Gantt Chart</h2>
            </div>
            <div class="gantt-controls">
                <button class="gantt-btn" onclick="openDateRangeModal()">📅 Select Date Range</button>
                <button class="gantt-btn" onclick="resetToYearView()">🔄 Reset to Year View</button>
            </div>
            <div class="gantt-container" id="gantt-container">
            </div>
        </div>

        <div id="kanban-board" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Kanban Board</h2>
            </div>
            <div class="kanban-board" id="kanban-board-container">
            </div>
        </div>

        <div id="dashboard" class="tab-content">
            <div class="content-header">
                <h2 class="content-title">Project Dashboard</h2>
            </div>
            <div class="dashboard-grid" id="dashboard-grid">
            </div>
        </div>
    </div>

    <div id="addTaskModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddTaskModal()">&times;</span>
            <h2>Add New Task</h2>
            <form id="addTaskForm">
                <div class="form-group">
                    <label for="mainTask">Main Task:</label>
                    <input type="text" id="mainTask" name="mainTask" required>
                </div>
                <div class="form-group">
                    <label for="subTask">Sub Task:</label>
                    <input type="text" id="subTask" name="subTask">
                </div>
                <div class="form-group">
                    <label for="description">Description:</label>
                    <textarea id="description" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label for="assignedTo">Assigned To:</label>
                    <input type="text" id="assignedTo" name="assignedTo">
                </div>
                <div class="form-group">
                    <label for="startDate">Start Date:</label>
                    <input type="date" id="startDate" name="startDate" required>
                </div>
                <div class="form-group">
                    <label for="endDate">End Date:</label>
                    <input type="date" id="endDate" name="endDate" required>
                </div>
                <div class="form-group">
                    <label for="priority">Priority:</label>
                    <select id="priority" name="priority" required>
                        <option value="">Select Priority</option>
                        <option value="HIGH">High</option>
                        <option value="MEDIUM">Medium</option>
                        <option value="LOW">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="status">Status:</label>
                    <select id="status" name="status" required>
                        <option value="">Select Status</option>
                        <option value="NOT STARTED">Not Started</option>
                        <option value="IN PROGRESS">In Progress</option>
                        <option value="COMPLETE">Complete</option>
                        <option value="ON HOLD">On Hold</option>
                        <option value="CANCELLED">Cancelled</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="progress">Progress (%):</label>
                    <input type="number" id="progress" name="progress" min="0" max="100" value="0">
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeAddTaskModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Task</button>
                </div>
            </form>
        </div>
    </div>

    <div id="dateRangeModal" class="modal">
        <div class="modal-content confirm-modal-content">
            <span class="close" onclick="closeDateRangeModal()">&times;</span>
            <h2>Select Date Range</h2>
            <div class="form-group">
                <label for="modalStartDateInput">Start Date:</label>
                <input type="date" id="modalStartDateInput">
            </div>
            <div class="form-group">
                <label for="modalEndDateInput">End Date:</label>
                <input type="date" id="modalEndDateInput">
            </div>
            <div class="confirm-buttons">
                <button class="btn btn-secondary" onclick="closeDateRangeModal()">Cancel</button>
                <button class="btn btn-primary" onclick="applyDateRange()">Apply</button>
            </div>
        </div>
    </div>

    <div id="confirmModal" class="modal">
        <div class="confirm-modal-content">
            <span class="close" onclick="closeConfirmModal()">&times;</span>
            <h3>Confirm Delete</h3>
            <p>Are you sure you want to delete this task?</p>
            <div class="confirm-buttons">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmDelete()" style="background: #e74c3c;">Delete</button>
            </div>
        </div>
    </div>

    <script>
        let tasks = [
            { id: 1, mainTask: "Test Task", subTask: "Test Sub Task", startDate: "2025-01-01T00:00:00", endDate: "2025-01-15T23:59:59", progress: 25, priority: "HIGH", status: "IN PROGRESS", assignedTo: "John Doe" },
            { id: 2, mainTask: "API Test Task", subTask: "", startDate: "2025-07-01T00:00:00", endDate: "2025-07-15T23:59:59", progress: 0, priority: "MEDIUM", status: "NOT STARTED", assignedTo: "" },
            { id: 3, mainTask: "GRI", subTask: "Collect", startDate: "2025-01-01T00:00:00", endDate: "2025-01-15T23:59:59", progress: 25, priority: "HIGH", status: "IN PROGRESS", assignedTo: "Sumon" },
            { id: 4, mainTask: "GRI", subTask: "ETL", startDate: "2025-01-17T00:00:00", endDate: "2025-01-23T23:59:59", progress: 10, priority: "MEDIUM", status: "IN PROGRESS", assignedTo: "Sumon" },
            { id: 5, mainTask: "Data Management", subTask: "Collect", startDate: "2025-06-01T00:00:00", endDate: "2025-06-05T23:59:59", progress: 100, priority: "LOW", status: "COMPLETE", assignedTo: "Chanasak" },
            { id: 6, mainTask: "Data Management", subTask: "Data Cleansing", startDate: "2025-06-11T00:00:00", endDate: "2025-06-18T23:59:59", progress: 40, priority: "LOW", status: "IN PROGRESS", assignedTo: "Chanasak" },
            { id: 7, mainTask: "Data Management", subTask: "Load to Database", startDate: "2025-06-20T00:00:00", endDate: "2025-06-27T23:59:59", progress: 0, priority: "LOW", status: "NOT STARTED", assignedTo: "Chanasak" },
            { id: 8, mainTask: "Overdue Task Example", subTask: "Finish before due date", startDate: "2025-06-01T00:00:00", endDate: "2025-06-30T23:59:59", progress: 50, priority: "HIGH", status: "IN PROGRESS", assignedTo: "Admin" }
        ];

        let currentGanttStartDate = new Date('2025-01-01T00:00:00');
        let currentGanttEndDate = new Date('2025-12-31T23:59:59');
        let taskToDeleteId = null;

        document.addEventListener('DOMContentLoaded', () => {
            populateAllViews();
            document.getElementById('addTaskForm').addEventListener('submit', handleFormSubmit);
            window.addEventListener('click', (event) => {
                const modals = ['addTaskModal', 'confirmModal', 'dateRangeModal'];
                modals.forEach(id => {
                    if (event.target === document.getElementById(id)) {
                        document.getElementById(id).style.display = 'none';
                    }
                });
            });
        });

        function handleFormSubmit(e) {
            e.preventDefault();
            const formData = new FormData(e.target);
            const editingId = e.target.dataset.editingId;

            const taskData = {
                mainTask: formData.get('mainTask'),
                subTask: formData.get('subTask') || '',
                description: formData.get('description') || '',
                assignedTo: formData.get('assignedTo') || '',
                startDate: `${formData.get('startDate')}T00:00:00`,
                endDate: `${formData.get('endDate')}T23:59:59`,
                priority: formData.get('priority'),
                status: formData.get('status'),
                progress: parseInt(formData.get('progress')) || 0
            };
            
            if (!taskData.mainTask || !taskData.startDate || !taskData.endDate || !taskData.priority || !taskData.status) {
                return alert('Please fill in all required fields');
            }

            if (editingId) {
                const taskIndex = tasks.findIndex(t => t.id == editingId);
                if (taskIndex !== -1) tasks[taskIndex] = { ...tasks[taskIndex], ...taskData };
            } else {
                tasks.push({ id: Date.now(), ...taskData });
            }
            populateAllViews();
            closeAddTaskModal();
        }

        function populateAllViews() {
            populateTaskTable();
            populateGanttChart();
            populateKanbanBoard();
            populateDashboard();
        }

        function showTab(tabName, clickedTabElement) {
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            clickedTabElement.classList.add('active');
        }

        function populateTaskTable() {
            const tbody = document.getElementById('task-table-body');
            tbody.innerHTML = '';
            tasks.forEach(task => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${task.mainTask}</td><td>${task.subTask}</td><td>${task.description}</td>
                    <td>${task.assignedTo}</td><td>${task.startDate.split('T')[0]}</td>
                    <td>${task.endDate.split('T')[0]}</td>
                    <td><span class="priority-${task.priority.toLowerCase()}">${task.priority}</span></td>
                    <td><span class="status-badge status-${task.status.toLowerCase().replace(/ /g, '-')}">${task.status}</span></td>
                    <td><span class="progress-text">${task.progress}%</span></td>
                    <td><button class="delete-btn" onclick="event.stopPropagation(); openConfirmModal(${task.id})">Delete</button></td>
                `;
                row.addEventListener('dblclick', () => editTask(task.id));
                tbody.appendChild(row);
            });
        }

        function openConfirmModal(taskId) {
            taskToDeleteId = taskId;
            document.getElementById('confirmModal').style.display = 'flex';
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').style.display = 'none';
        }

        function confirmDelete() {
            if (taskToDeleteId !== null) {
                tasks = tasks.filter(task => task.id !== taskToDeleteId);
                populateAllViews();
                closeConfirmModal();
            }
        }

        function openAddTaskModal() {
            const form = document.getElementById('addTaskForm');
            form.reset();
            delete form.dataset.editingId;
            document.querySelector('#addTaskModal h2').textContent = 'Add New Task';
            document.querySelector('#addTaskModal .btn-primary').textContent = 'Add Task';
            document.getElementById('addTaskModal').style.display = 'flex';
        }

        function closeAddTaskModal() {
            document.getElementById('addTaskModal').style.display = 'none';
        }

        function editTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            document.getElementById('mainTask').value = task.mainTask || '';
            document.getElementById('subTask').value = task.subTask || '';
            document.getElementById('description').value = task.description || '';
            document.getElementById('assignedTo').value = task.assignedTo || '';
            document.getElementById('startDate').value = task.startDate.split('T')[0];
            document.getElementById('endDate').value = task.endDate.split('T')[0];
            document.getElementById('priority').value = task.priority || '';
            document.getElementById('status').value = task.status || '';
            document.getElementById('progress').value = task.progress || 0;
            document.querySelector('#addTaskModal h2').textContent = 'Edit Task';
            document.querySelector('#addTaskModal .btn-primary').textContent = 'Update Task';
            document.getElementById('addTaskForm').dataset.editingId = taskId;
            document.getElementById('addTaskModal').style.display = 'flex';
        }

        function populateGanttChart(chartStartDate = currentGanttStartDate, chartEndDate = currentGanttEndDate) {
            const container = document.getElementById('gantt-container');
            container.innerHTML = '';

            const filteredTasks = tasks.filter(task => new Date(task.startDate) <= chartEndDate && new Date(task.endDate) >= chartStartDate);
            if (filteredTasks.length === 0) {
                container.innerHTML = '<div style="padding: 40px; text-align:center; color: #6c7b84;">No tasks in selected date range.</div>';
                return;
            }

            const totalDurationMs = chartEndDate.getTime() - chartStartDate.getTime();
            if (totalDurationMs <= 0) return;

            let headerMonthsHtml = '';
            let tempDateForHeader = new Date(chartStartDate);
            while (tempDateForHeader <= chartEndDate) {
                const monthStart = new Date(tempDateForHeader.getFullYear(), tempDateForHeader.getMonth(), 1);
                const nextMonthStart = new Date(monthStart.getFullYear(), monthStart.getMonth() + 1, 1);
                const effectiveStart = Math.max(monthStart.getTime(), chartStartDate.getTime());
                const effectiveEnd = Math.min(nextMonthStart.getTime(), chartEndDate.getTime() + 1);
                const monthDurationInView = effectiveEnd - effectiveStart;
                const monthWidthPercent = (monthDurationInView / totalDurationMs) * 100;
                if(monthWidthPercent > 0) {
                    headerMonthsHtml += `<div class="gantt-month" style="width: ${monthWidthPercent}%;">${monthStart.toLocaleString('en-US', { month: 'short', year: 'numeric' })}</div>`;
                }
                tempDateForHeader.setMonth(tempDateForHeader.getMonth() + 1);
            }

            let verticalLinesHtml = '';
            let tempLineDate = new Date(chartStartDate.getFullYear(), chartStartDate.getMonth() + 1, 1);
            while (tempLineDate < chartEndDate) {
                const linePosition = ((tempLineDate.getTime() - chartStartDate.getTime()) / totalDurationMs) * 100;
                verticalLinesHtml += `<div class="gantt-v-line" style="left: ${linePosition}%;"></div>`;
                tempLineDate.setMonth(tempLineDate.getMonth() + 1);
            }

            const groupedTasks = filteredTasks.reduce((acc, task) => { (acc[task.mainTask] = acc[task.mainTask] || []).push(task); return acc; }, {});
            let rowsHtml = '';
            Object.values(groupedTasks).forEach(subTasks => {
                const barContainerHtml = (taskOrTasks) => `<div class="gantt-bars">${verticalLinesHtml}${Array.isArray(taskOrTasks) ? generateMainTaskBar(taskOrTasks, chartStartDate, totalDurationMs) : generateTaskBar(taskOrTasks, chartStartDate, totalDurationMs)}</div>`;
                if (subTasks.some(t => t.subTask)) {
                    rowsHtml += `<div class="gantt-row main-task-row" data-main-task-group="${subTasks[0].mainTask}"><div class="gantt-task-name"><button class="expand-btn" onclick="toggleMainTask('${subTasks[0].mainTask}')">▶</button>${subTasks[0].mainTask}</div>${barContainerHtml(subTasks)}</div>`;
                    subTasks.forEach(task => {
                        if (task.subTask) rowsHtml += `<div class="gantt-row sub-task-row" data-main-task="${task.mainTask}" style="display: none;"><div class="gantt-task-name" style="padding-left: 40px;">${task.subTask}</div>${barContainerHtml(task)}</div>`;
                    });
                } else {
                    rowsHtml += `<div class="gantt-row"><div class="gantt-task-name">${subTasks[0].mainTask}</div>${barContainerHtml(subTasks[0])}</div>`;
                }
            });

            const ganttGrid = document.createElement('div');
            ganttGrid.className = 'gantt-grid';
            ganttGrid.innerHTML = `<div class="gantt-header"><div class="gantt-task-column">Task</div><div class="gantt-timeline">${headerMonthsHtml}</div></div>${rowsHtml}`;
            
            const now = new Date();
            if (now >= chartStartDate && now <= chartEndDate) {
                const currentPositionPercent = ((now.getTime() - chartStartDate.getTime()) / totalDurationMs) * 100;
                const currentLine = document.createElement('div');
                currentLine.className = 'current-day-line';
                currentLine.style.left = `calc(200px + ${(timeline.offsetWidth / 100) * currentPositionPercent}px)`;
                ganttGrid.appendChild(currentLine);
            }
            container.appendChild(ganttGrid);
        }

        function generateBar(startDate, endDate, progress, isMain, chartStartDate, totalDurationMs) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const startPos = Math.max(0, start.getTime() - chartStartDate.getTime());
            const endPos = Math.min(totalDurationMs, end.getTime() - chartStartDate.getTime());
            const left = (startPos / totalDurationMs) * 100;
            let width = ((endPos - startPos) / totalDurationMs) * 100;
            if (width < 0) width = 0;
            const labelPosition = Math.min(95, left + width);
            return `<div class="gantt-bar ${isMain ? 'main-task' : 'sub-task'}" style="left: ${left}%; width: ${width}%;"></div><div class="gantt-progress-label" style="left: calc(${labelPosition}% + 5px);">${progress}%</div>`;
        }
        function generateMainTaskBar(tasks, chartStartDate, totalDurationMs) { const startDates = tasks.map(t => new Date(t.startDate).getTime()); const endDates = tasks.map(t => new Date(t.endDate).getTime()); const earliestStart = new Date(Math.min(...startDates)); const latestEnd = new Date(Math.max(...endDates)); const avgProgress = tasks.length > 0 ? Math.round(tasks.reduce((sum, t) => sum + t.progress, 0) / tasks.length) : 0; return generateBar(earliestStart, latestEnd, avgProgress, true, chartStartDate, totalDurationMs); }
        function generateTaskBar(task, chartStartDate, totalDurationMs) { return generateBar(task.startDate, task.endDate, task.progress, false, chartStartDate, totalDurationMs); }
        function toggleMainTask(mainTaskName) { const rows = document.querySelectorAll(`[data-main-task="${mainTaskName}"]`); const btn = document.querySelector(`[data-main-task-group="${mainTaskName}"] .expand-btn`); if(!rows.length || !btn) return; const isHidden = rows[0].style.display === 'none'; rows.forEach(r => r.style.display = isHidden ? 'flex' : 'none'); btn.textContent = isHidden ? '▼' : '▶'; }
        function openDateRangeModal() { document.getElementById('modalStartDateInput').value = currentGanttStartDate.toISOString().split('T')[0]; document.getElementById('modalEndDateInput').value = currentGanttEndDate.toISOString().split('T')[0]; document.getElementById('dateRangeModal').style.display = 'flex'; }
        function closeDateRangeModal() { document.getElementById('dateRangeModal').style.display = 'none'; }
        function applyDateRange() { const start = document.getElementById('modalStartDateInput').value; const end = document.getElementById('modalEndDateInput').value; if (!start || !end) return alert('Please select both start and end dates.'); const newStart = new Date(`${start}T00:00:00`); const newEnd = new Date(`${end}T23:59:59`); if (newStart > newEnd) return alert('Start Date cannot be after End Date.'); currentGanttStartDate = newStart; currentGanttEndDate = newEnd; populateGanttChart(); closeDateRangeModal(); }
        function resetToYearView() { const year = new Date().getFullYear(); currentGanttStartDate = new Date(`${year}-01-01T00:00:00`); currentGanttEndDate = new Date(`${year}-12-31T23:59:59`); populateGanttChart(); }
        
        function populateKanbanBoard() {
            const container = document.getElementById('kanban-board-container');
            const statusColumns = { 'Not Started': [], 'In Progress': [], 'On Hold': [], 'Complete': [], 'Overdue': [], 'Cancelled': [] };
            const today = new Date(); today.setHours(0, 0, 0, 0);
            tasks.forEach(task => {
                const endDate = new Date(task.endDate);
                if (task.status !== 'COMPLETE' && task.status !== 'CANCELLED' && endDate < today) {
                    statusColumns['Overdue'].push(task);
                } else if (statusColumns[task.status]) {
                    statusColumns[task.status].push(task);
                }
            });
            container.innerHTML = Object.keys(statusColumns).map(status => {
                const tasksInStatus = statusColumns[status];
                return `<div class="kanban-column"><div class="kanban-header">${status}<span class="kanban-count">${tasksInStatus.length}</span></div>${tasksInStatus.map(task => `<div class="kanban-card"><h4>${task.mainTask}</h4>${task.subTask ? `<div class="sub-task">${task.subTask}</div>` : ''}${task.assignedTo ? `<div class="assigned-to"><strong>Assigned to:</strong> ${task.assignedTo}</div>` : ''}<div class="progress"><strong>Progress:</strong> ${task.progress}%</div><div class="dates">${task.startDate.split('T')[0]} - ${task.endDate.split('T')[0]}</div></div>`).join('')}</div>`;
            }).join('');
        }

        function populateDashboard() {
            const container = document.getElementById('dashboard-grid');
            const total = tasks.length;
            const completed = tasks.filter(t => t.status === 'COMPLETE').length;
            const inProgress = tasks.filter(t => t.status === 'IN PROGRESS').length;
            const today = new Date(); today.setHours(0, 0, 0, 0);
            const overdue = tasks.filter(t => t.status !== 'COMPLETE' && t.status !== 'CANCELLED' && new Date(t.endDate) < today).length;
            container.innerHTML = `<div class="dashboard-card"><h3>${total}</h3><p>Total Tasks</p></div><div class="dashboard-card completed"><h3>${completed}</h3><p>Completed</p></div><div class="dashboard-card in-progress"><h3>${inProgress}</h3><p>In Progress</p></div><div class="dashboard-card overdue"><h3>${overdue}</h3><p>Overdue</p></div>`;
        }

    </script>
</body>
</html>
